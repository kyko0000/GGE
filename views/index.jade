//
   Created by yuechungng on 15/2/2016.

extends layout

block content
    .container#cookies-reminder
        #cookies-text A past visit record has been detected. Do you want to recover the the past record?
        btn#cookies-ok.btn-circle(style='background-color:green')
            i.glyphicon.glyphicon-ok
        btn#cookies-no.btn-circle(style='background-color:red')
            span.glyphicon.glyphicon-remove
    #chromosomes-navigator-container.container
        #chromosomes-nav-title-container
            h3#chromosomes-nav-title Chromosomes Navigator
        svg#chromosomes-navigator(style='width:100%; height:100%;')
        #information-btn-container
            .chromosome-type
                .Autosomes Autosomes (Body Chromosomes)
                .Allosomes Allosomes (Sex Chromosomes)
            #btn-chromosome-type.btn Chromosome Types
        script.
            $(document).ready()
            {
                $('.spinner-div').show();
                var chrNavHeight = screen.height * 0.6;
                $("#chromosomes-navigator").css('height', chrNavHeight);
                $.ajax({
                    url: './api/getChromosome/',
                    data: '',
                    type: "GET",
                    success: function(data)
                    {
                        var chromosomesObj = JSON.parse(data);
                        var chrNav = new ChrNav(chromosomesObj,$("#chromosomes-navigator"));
                        //alert(data);
                    },
                    error:function(xtr, status, err)
                    {
                        alert("Ajax Get Chromosome Error");
                    }
                })

                //handle cookies
                var cookies = '#{cookies}';
                if(cookies != '0')
                {
                    $('#cookies-reminder').toggle(500);
                    cookies = cookies.replace(/&quot;/g, '"');
                    var cookiesObj = JSON.parse(cookies);
                    var cookiesText = $('#cookies-text');
                    if(cookiesObj.type == 'chromosome-region')
                        $(cookiesText).append(" Chromosome" + cookiesObj.chr + ": " + cookiesObj.regionStart + " - " + cookiesObj.regionEnd);
                    else if (cookiesObj.type == 'symbol')
                        $(cookiesText).append(" Gene Symbol: " + cookiesObj.symbol);
                    else if(cookiesObj.type == 'gene-id')
                        $(cookiesText).append(" Gene ID: " + cookiesObj.id);
                }

                $('#cookies-no').click(function(e)
                {
                    $('#cookies-reminder').toggle(500);
                });

                $("#cookies-ok").click(function(e)
                {
                    $('#cookies-reminder').toggle(500);

                    var query  = {};
                    query.type = cookiesObj.type;
                    if(query.type == 'chromosome-region') {
                        query.chromosomeName = cookiesObj.chr;
                        query.regionStart = cookiesObj.regionStart;
                        query.regionEnd = cookiesObj.regionEnd;
                    }
                    else if(query.type  == 'symbol')
                    {
                        query.symbol = cookiesObj.symbol;
                    }
                    else if(query.type == 'gene-id')
                    {
                        query.id = cookiesObj.id;
                    }
                    $('.spinner-div').show();
                    $.ajax(
                            {
                                url: './gene',
                                data: query,
                                type: 'GET',
                                success: function (data) {
                                    $(".container").remove();
                                    $('body').append(data);
                                }
                                ,
                                error: function (xhr, status, error) {
                                    alert("Error: " + error.message);
                                }
                            });
                });
            }



